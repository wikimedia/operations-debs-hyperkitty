From c95c00276000f48f1ac2d211450f54454e74fe9c Mon Sep 17 00:00:00 2001
From: Abhilash Raj <raj.abhilash1@gmail.com>
Date: Sun, 17 Nov 2019 19:17:45 -0800
Subject: [PATCH] Fix for networkx 2.4

---
 hyperkitty/lib/analysis.py | 4 ++--
 setup.py                   | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/hyperkitty/lib/analysis.py b/hyperkitty/lib/analysis.py
index 87120fba..cfaba7a3 100644
--- a/hyperkitty/lib/analysis.py
+++ b/hyperkitty/lib/analysis.py
@@ -34,14 +34,14 @@ def compute_thread_order_and_depth(thread):
     thread_pos = {"d": 0, "o": 0}  # depth, order
 
     def walk_successors(msgid):
-        obj = graph.node[msgid]["obj"]
+        obj = graph.nodes[msgid]["obj"]
         obj.thread_depth = thread_pos["d"]
         obj.thread_order = thread_pos["o"]
         obj.save(update_fields=["thread_depth", "thread_order"])
         thread_pos["d"] += 1
         thread_pos["o"] += 1
         for succ in sorted(graph.successors(msgid),
-                           key=lambda m: graph.node[m]["num"]):
+                           key=lambda m: graph.nodes[m]["num"]):
             walk_successors(succ)
         thread_pos["d"] -= 1
     for index, email in enumerate(thread.emails.order_by("date")):
diff --git a/setup.py b/setup.py
index 1844d7f7..48a30c95 100755
--- a/setup.py
+++ b/setup.py
@@ -46,7 +46,7 @@ REQUIRES = [
     "django-compressor>=1.3",
     "mailmanclient>=3.1.1",
     "python-dateutil >= 2.0",
-    "networkx>=1.9.1",
+    "networkx>=2.0",
     "django-haystack>=2.8.0",
     "django-extensions>=1.3.7",
     "flufl.lock",
-- 
2.24.1

